

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        // Show loading overlay
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingStatus = document.getElementById('loadingStatus');
        
        // Quiz data - will be populated from CSV
        const quizData = { tests: [] };
        
        // User progress data - stored in memory only
        const userProgress = {};
        
        // Current quiz state
        let currentTest = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let startTime = null;
        let timerInterval = null;
        
        // DOM Elements
        const appContainer = document.getElementById('appContainer');
        const dashboardScreen = document.getElementById('dashboardScreen');
        const quizScreen = document.getElementById('quizScreen');
        const resultsScreen = document.getElementById('resultsScreen');
        const progressContainer = document.getElementById('progressContainer');
        const questionContainer = document.getElementById('questionContainer');
        const optionsContainer = document.getElementById('optionsContainer');
        const questionText = document.getElementById('questionText');
        const questionImage = document.getElementById('questionImage');
        const explanationContainer = document.getElementById('explanationContainer');
        const explanationText = document.getElementById('explanationText');
        const questionCounter = document.getElementById('questionCounter');
        const progressBarFill = document.getElementById('progressBarFill');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const userDisplay = document.getElementById('userDisplay');
        const userAvatar = document.getElementById('userAvatar');
        const testSelector = document.getElementById('testSelector');
        const timeSpent = document.getElementById('timeSpent');
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            try {
                loadingStatus.textContent = "Initializing application...";
                
                // Add event listeners
                document.getElementById('mixedQuizBtn').addEventListener('click', startMixedQuiz);
                prevBtn.addEventListener('click', goToPreviousQuestion);
                nextBtn.addEventListener('click', goToNextQuestion);
                document.getElementById('reviewBtn').addEventListener('click', reviewAnswers);
                document.getElementById('returnToDashboardBtn').addEventListener('click', returnToDashboard);
                
                // Start loading data
                loadCSVData();
            } catch (error) {
                console.error('Error initializing app:', error);
                hideLoading();
                alert('There was an error initializing the application. Please refresh the page and try again.');
            }
        });
        
        // CSV data for all questions (sample of first few questions shown)
        // NOTE: In the final version, this will be a complete string with all 1,211 questions
        const csvData = `Question,Answer A,Answer B,Answer C,Answer D,Answer E,Correct,Explaination,Image
A 33-year-old female presents with numbness and weakness in the right side of her face for several days as shown in the image. The remainder of her examination is normal and she has no other symptoms. Which of the following is the next best step in management? ,Valacyclovir ,Prednisone ,Tissue plasminogen activator ,Sour candy ,Amoxicillin–clavulanic acid ,B,"With unilateral upper and lower facial weakness and the absence of other concerning neurologic  features, the diagnosis is very likely idiopathic facial nerve palsy, also known as Bell palsy. Steroid therapy  (prednisone 60 mg daily for 1 week) has been shown to improve outcomes in Bell palsy, but antiviral therapy  in the absence of steroids appears to have no effect. Tissue plasminogen activator would be indicated for an  acute ischemic stroke within 3 hours of presentation, but would not be appropriate in this case. Sour candy  can be used to treat sialolithiasis, but there is no observable swelling to suggest this. Antibiotics are not  indicated for the management of Bell palsy. (Figure from Salimpour RR, Salimpour P, Salimpour P.  Photographic Atlas of Pediatric Disorders and Diagnosis. 1st ed. Philadelphia, PA: Wolters Kluwer; 2013.)",t1-1.png
"A 23-year-old female presents with 2 days of fever and severe right ankle pain and swelling. She denies a history of trauma. Past medical history is unremarkable. Physical examination reveals significant edema, effusion, tenderness, and pain on range of motion in the right ankle. Which of the following is the most likely etiology? ",S. aureus ,S. pneumoniae ,S. pyogenes ,Salmonella ,E.N. gonorrhoeae ,E,"The patient has evidence of acute monoarticular arthritis. In a young, sexually active patient  without prior history of arthritis, the most likely bacterial cause is gonococcus. The overall most common  cause of septic arthritis is S. aureus. Choices B, C, and D are less common causes. Septic arthritis is a joint threatening infection diagnosed by synovial fluid analysis. It must be aggressively treated with intravenous  antibiotics and possible surgical irrigation, even though gonococcal arthritis rarely requires surgical  management. ",
A 77-year-old male with Parkinson disease is brought to the hospital with obstipation. His abdomen is distended and mildly tender with decreased bowel sounds. His abdominal x-ray is shown in the image. Which of the following is the most likely diagnosis? ,Small bowel ischemia ,Viscus perforation ,Sigmoid volvulus ,Swallowed air ,Gastric outlet obstruction,C,"The image indicates sigmoid volvulus. Abdominal radiography lacks sensitivity for small bowel  ischemia and signs such as thumbprinting and pneumatosis are rare. Viscus perforation would be suspected if  there were free air seen under the diaphragm, but abdominal radiography is incompletely sensitive for  evaluation of perforation. Swallowed air would be unlikely to cause abdominal distention and obstipation.  Gastric outlet obstruction might not demonstrate any findings on x-ray. Of all the answer choices, sigmoid  volvulus is the only diagnosis that can be made solely relying on abdominal radiography. (Figure from  Daffner RH. Clinical Radiology: The Essentials. 3rd ed. Philadelphia, PA: Lippincott Williams & Wilkins; 2007.)",t1-3.png
"A 27-year-old female without past medical history presents with 2 days of pain in her right ear. The patient notes that the symptoms started with an itchy ear which progressed to pain, discharge, and hearing loss. Examination reveals an afebrile patient who is nontoxic, with moderate tenderness on manipulation of the auricle, erythema and edema of the tympanic canal, and no external rash. Cranial nerve examination is normal. Which of the following will be most helpful in treating this condition? ",Antihistamines ,Tympanostomy tubes ,Systemic antivirals ,Adenoidectomy ,Acetic acid otic washes ,E,"The patient has otitis externa, inflammation of the external ear, and tympanic canal almost  always because of infection. Trauma and excessive moisture are commonly implicated in the development of  the condition. Patients generally present with otalgia and otorrhea. Debridement of the external ear canal is  the most important aspect of treatment. In nontoxic patients, this is achieved with topical acetic acid washes  with or without topical antibiotics and steroids. A cotton or methylcellulose wick for drainage of the  tympanic canal may be placed 1 cm deep in the ear and stays for 2 days. Systemically ill patients or diabetic  patients require systemic antibiotics and sometimes admission. Antihistamines can be used for symptomatic  relief but do not affect the duration of illness. Tympanostomy tubes and adenoidectomy may be indicated for  prevention of chronic/recurrent otitis media but have no effect on acute management of otitis externa.  Herpes zoster can occur in the ear and is referred to as Ramsay Hunt syndrome. This condition requires antivirals and is associated with a vesicular rash and sometimes cranial nerve palsies. ",
"A 35-year-old female without any past medical history presents with a red, painful region on her right arm where she had a bug bite 3 days before. She denies fever. She is allergic to penicillin. Vital signs are normal. Physical examination is remarkable for a 10 × 6 cm2 area on her right arm that is red, warm, tender, and sharply demarcated. There is no lymphangitic streaking or axillary lymphadenopathy. You diagnose her with cellulitis. Which of the following is the most appropriate choice of antibiotic? ",Clindamycin ,Doxycycline ,Dicloxacillin ,Linezolid ,Metronidazole ,A,"Cellulitis in the healthy patient is most often caused by Streptococci and Staphylococci. In most  communities, methicillin-resistant Staphylococcus aureus (MRSA) accounts for a significant number of  staphylococcal infections. Thus, initial antibiotic therapy is usually with a penicillinase-resistant penicillin or  first-generation cephalosporin to treat streptococci plus TMP-SMX to treat MRSA. Doxycycline covers MRSA  but is inadequate against streptococci, so it should be combined with amoxicillin (or cephalexin).  Clindamycin can be used as monotherapy, but there is significant resistance to clindamycin among MRSA  isolates in many communities. This patient has an allergy to penicillin, and dicloxacillin is therefore  contraindicated. In addition, dicloxacillin is ineffective against MRSA. Linezolid is an effective, relatively new  treatment that is generally reserved for infections that are not amenable to treatment with the other options  listed above. Metronidazole covers anaerobes only and would not be appropriate as monotherapy for  cellulitis. Note that in its most recent guidelines (2011), the Infectious Disease Society of America  differentiates between purulent and nonpurulent cellulitis. The rationale behind this division is to illustrate  that MRSA is typically responsible for abscess formation and the development of purulent drainage. Thus, in  cases in which both cellulitis and an abscess are present (or forming), empiric therapy directed only at MRSA  is appropriate, and dual therapy is unnecessary. Clindamycin, doxycycline, TMP-SMX, and linezolid are all useful for monotherapy in this setting.",
Clinically significant hypermagnesemia almost always occurs in the setting of: ,Renal insufficiency ,Pancreatitis ,Trauma ,Laxative abuse ,Alcoholism ,A,"The kidneys are almost wholly responsible for magnesium excretion and are able to enhance  excretion in the setting of a magnesium load. Therefore, in the absence of renal insufficiency,  hypermagnesemia rarely occurs. Abuse of magnesium-containing laxatives may cause a transient increase in  magnesium levels but will not persist in the setting of normal renal function. Trauma could feasibly lead to  hypermagnesemia if associated with rhabdomyolysis. ",
Which of the following is true about myasthenia gravis (MG)? ,Incidence peaks in the eighth decade of life. ,Sensory deficits are most severe in the lower extremities. ,The most frequent initial symptom is dysarthria. ,Cooling decreases symptoms. ,Muscle weakness tends to worsen after long periods of rest. ,D,"The fact that cooling improves the symptoms of MG is the basis for the "ice test." When ptosis is  present, an ice pack is placed over the affected eye for 2 minutes. It is thought that the local cooling results in  a slowing of the kinetics of the acetylcholine receptor, allowing for a prolonged effect of acetylcholine and an  improvement in symptoms. In clinical studies, 80% of patients with ptosis due to MG experienced some  improvement with a locally applied ice pack. MG has a bimodal peak of incidence with the first peak in the  20s and the second peak in the 50s. Interestingly, women are more commonly affected during the first peak,  but men are more commonly affected in the second peak. Sensory loss is not a feature of MG. The most  frequent initial symptoms of MG are ptosis and diplopia due to ocular muscular weakness or weakness of the  levator palpebrae superioris. ",
"A 57-year-old female with a history of hypertension presents with headache, mild confusion, and vomiting.  She describes an acutely worsening global headache over the last several hours with nausea and vomiting. A  family member states she is confused. She admits to noncompliance with her blood pressure medications for  the last week. Vital signs are: T 98.4, HR 92, BP 220/130, RR 20, SpO2 97%. Examination reveals a patient  in moderate discomfort, papilledema, hypertensive retinopathy, and a nonfocal neurologic examination.  Laboratory studies, EKG, and noncontrast CT brain are all normal. Which of the following is the most  appropriate next step in management? ",Neurosurgical consultation ,Reduction of blood pressure by 25% ,Lumbar puncture ,Corticosteroids ,Noncontrast MRI of the brain ,B,"The patient has hypertensive encephalopathy. The history of acute headache with vomiting and  confusion in the setting of severely elevated blood pressure is characteristic. Neuroimaging with CT scan is  often normal. The treatment is immediate reduction of blood pressure by as much as 30%. By definition,  hypertensive encephalopathy is reversible when blood pressure is reduced. Neurosurgical consultation may be  indicated later in the course, but blood pressure management should be instituted early. Lumbar puncture  would be contraindicated in this circumstance due to the papilledema indicating increased intracranial  pressure. Corticosteroids are indicated in cases of temporal arteritis, which is on the differential diagnosis but  is far less common than hypertensive encephalopathy and requires the presence of an elevated erythrocyte sedimentation rate. MRI of the brain can add important structural information but is not indicated emergently. ",
The hallmark of rubella is: ,Generalized lymphadenopathy ,Tonsillar exudates ,Koplik spots ,Febrile seizures ,Pastia lines ,A,"In children, rubella (German measles) is characterized by a minimal prodromal illness (as opposed to adults), a "3-day rash," and generalized lymphadenopathy. Forchheimer spots, pinpoint or larger  erythematous spots on the soft palate, may also be found. However, similar lesions may also be seen in  measles and scarlet fever, so the presence of Forschheimer spots is not pathognomonic for rubella. The rash is  a pink-red maculopapular eruption that first appears on the face and rapidly spreads downward to the neck,  arms, trunk, and legs. On the second day, it begins to disappear from the face and the entire rash typically  disappears by the end of the third day. Lymphadenopathy is generalized but most commonly involves the  suboccipital, postauricular, and cervical nodes. Although lymph node tenderness typically subsides after 1 to  2 days, lymphadenopathy may persist for several weeks. Tonsillar exudates are present in several causes of  pharyngitis. Koplik spots are pathognomonic for measles. Febrile seizures classically occur in patients with  roseola infantum (exanthem subitum). Pastia lines occur in scarlet fever. ",`;
        
        // NOTE: In the full application, the CSV string would be extended to include all 1,211 questions
        
        // Load the complete 1,211 questions from the CSV file
        async function loadCSVData() {
            try {
                loadingStatus.textContent = "Loading CSV file from folder...";
                
                // Fetch the CSV file from the same directory
                try {
                    const response = await fetch('Questions.csv');
                    
                    if (!response.ok) {
                        throw new Error(`Failed to load CSV file: ${response.status} ${response.statusText}`);
                    }
                    
                    const csvText = await response.text();
                    
                    loadingStatus.textContent = "Parsing CSV data...";
                    
                    // Parse the CSV data
                    const result = Papa.parse(csvText, {
                        header: true,
                        skipEmptyLines: true
                    });
                    
                    if (result.errors.length > 0) {
                        console.error("CSV parsing errors:", result.errors);
                        loadingStatus.textContent = "Error parsing CSV data. Loading sample questions...";
                        setTimeout(() => {
                            loadSampleQuestions();
                        }, 1000);
                        return;
                    }
                    
                    const questions = result.data;
                    loadingStatus.textContent = `Processing ${questions.length} questions...`;
                    
                    // Divide questions into 12 tests (approximately 101 questions per test)
                    const questionsPerTest = Math.ceil(questions.length / 12);
                    
                    // Process in chunks to prevent UI blocking
                    setTimeout(() => {
                        processQuestionsInChunks(questions, questionsPerTest, 0);
                    }, 100);
                    
                } catch (error) {
                    console.error('Error loading CSV file:', error);
                    loadingStatus.textContent = "Error loading CSV file. Loading sample questions...";
                    setTimeout(() => {
                        loadSampleQuestions();
                    }, 1000);
                }
            } catch (error) {
                console.error('Error in loadCSVData:', error);
                loadingStatus.textContent = "Error processing data. Loading sample questions...";
                setTimeout(() => {
                    loadSampleQuestions();
                }, 1000);
            }
        }
        
        // Process questions in chunks to prevent UI blocking
        function processQuestionsInChunks(questions, questionsPerTest, startTestIndex) {
            if (startTestIndex >= 12) {
                // All tests processed, continue with the application
                loadingStatus.textContent = `Loaded ${quizData.tests.length} tests with ${questions.length} questions`;
                setTimeout(() => {
                    hideLoading();
                    loadDashboard();
                }, 500);
                return;
            }
            
            // Process one test at a time
            const testIndex = startTestIndex;
            const startQuestionIndex = testIndex * questionsPerTest;
            const endQuestionIndex = Math.min(startQuestionIndex + questionsPerTest, questions.length);
            
            loadingStatus.textContent = `Processing Test ${testIndex + 1} (Questions ${startQuestionIndex + 1}-${endQuestionIndex})...`;
            
            // Create test object
            const test = {
                id: testIndex + 1,
                name: `Test ${testIndex + 1}`,
                questions: []
            };
            
            // Process questions for this test
            for (let i = startQuestionIndex; i < endQuestionIndex; i++) {
                const row = questions[i];
                test.questions.push({
                    question: row.Question || "",
                    options: [
                        (row["Answer A"] || "").trim(),
                        (row["Answer B"] || "").trim(),
                        (row["Answer C"] || "").trim(),
                        (row["Answer D"] || "").trim(),
                        (row["Answer E"] || "").trim()
                    ],
                    correctAnswer: (row.Correct || "").trim(),
                    explanation: row.Explaination || "",
                    image: (row.Image || "").trim() || null
                });
            }
            
            // Add test to quiz data
            quizData.tests.push(test);
            
            // Process next test after a small delay
            setTimeout(() => {
                processQuestionsInChunks(questions, questionsPerTest, startTestIndex + 1);
            }, 50);
        }
        
        // Load sample questions if CSV loading fails
        function loadSampleQuestions() {
            quizData.tests = [];
            
            for (let i = 1; i <= 12; i++) {
                const questions = [];
                
                for (let j = 1; j <= 100; j++) {
                    questions.push({
                        question: `Sample question ${j} for Test ${i}. This is a placeholder question for medical students.`,
                        options: [
                            "Option A - First possible answer", 
                            "Option B - Second possible answer", 
                            "Option C - Third possible answer", 
                            "Option D - Fourth possible answer", 
                            "Option E - Fifth possible answer"
                        ],
                        correctAnswer: String.fromCharCode(65 + Math.floor(Math.random() * 5)),
                        explanation: `This is a sample explanation for question ${j} of Test ${i}. In a real quiz, this would contain detailed information about why the correct answer is correct and why the other options are incorrect.`,
                        image: j % 5 === 0 ? `sample_image_${i}_${j}.png` : null
                    });
                }
                
                quizData.tests.push({
                    id: i,
                    name: `Test ${i}`,
                    questions: questions
                });
            }
            
            hideLoading();
            loadDashboard();
        }
        
        // Hide loading overlay
        function hideLoading() {
            loadingOverlay.style.display = 'none';
        }
        
        // Load dashboard
        function loadDashboard() {
            // Clear previous content
            progressContainer.innerHTML = '';
            
            // Update overall progress statistics
            updateOverallProgress();
            
            // Create test cards
            quizData.tests.forEach(test => {
                // Get progress for this test
                const testProgress = userProgress[test.id] || {
                    completed: 0,
                    lastQuestionIndex: 0,
                    answers: Array(test.questions.length).fill(null)
                };
                
                // Calculate progress percentage
                const percentComplete = Math.round((testProgress.completed / test.questions.length) * 100);
                
                // Create test card
                const testCard = document.createElement('div');
                testCard.className = 'test-card';
                testCard.innerHTML = `
                    <h3>${test.name}</h3>
                    <p>${testProgress.completed} of ${test.questions.length} completed</p>
                    <div class="progress-bar">
                        <div class="progress-bar-fill" style="width: ${percentComplete}%;"></div>
                    </div>
                `;
                
                // Add click event
                testCard.addEventListener('click', () => {
                    startTest(test.id);
                });
                
                // Add to container
                progressContainer.appendChild(testCard);
            });
            
            // Show dashboard
            dashboardScreen.classList.remove('hidden');
            quizScreen.classList.add('hidden');
            resultsScreen.classList.add('hidden');
        }
        
        // Update overall progress statistics
        function updateOverallProgress() {
            let totalQuestions = 0;
            let totalAttempted = 0;
            let totalCorrect = 0;
            let totalWrong = 0;
            
            // Calculate totals from all tests
            Object.keys(userProgress).forEach(testId => {
                const testProgress = userProgress[testId];
                const test = quizData.tests.find(t => t.id == testId);
                
                if (test) {
                    totalQuestions += test.questions.length;
                    
                    testProgress.answers.forEach((answer, index) => {
                        if (answer !== null) {
                            totalAttempted++;
                            
                            if (answer === test.questions[index].correctAnswer) {
                                totalCorrect++;
                            } else {
                                totalWrong++;
                            }
                        }
                    });
                }
            });
            
            // Calculate accuracy
            const accuracy = totalAttempted > 0 ? Math.round((totalCorrect / totalAttempted) * 100) : 0;
            
            // Update UI
            document.getElementById('totalAttempted').textContent = totalAttempted;
            document.getElementById('totalCorrect').textContent = totalCorrect;
            document.getElementById('totalWrong').textContent = totalWrong;
            document.getElementById('overallAccuracy').textContent = `${accuracy}%`;
        }
        
        // Start a test
        function startTest(testId) {
            // Get the test
            currentTest = quizData.tests.find(test => test.id === testId);
            
            // Initialize test progress if not exists
            if (!userProgress[testId]) {
                userProgress[testId] = {
                    completed: 0,
                    lastQuestionIndex: 0,
                    answers: Array(currentTest.questions.length).fill(null)
                };
            }
            
            // Load user answers
            userAnswers = [...userProgress[testId].answers];
            
            // Set current question index
            currentQuestionIndex = userProgress[testId].lastQuestionIndex;
            
            // Update test selector
            updateTestSelector();
            
            // Load question
            loadQuestion();
            
            // Show quiz screen
            dashboardScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            
            // Start timer
            startTimer();
        }
        
        // Start mixed quiz
        function startMixedQuiz() {
            // Create a mixed test from all available questions
            const mixedQuestions = [];
            
            // Collect questions from all tests
            quizData.tests.forEach(test => {
                // Skip if the test has no questions
                if (!test.questions || test.questions.length === 0) return;
                
                // Take a sample of questions from each test
                const sampleSize = Math.min(10, test.questions.length);
                const sampledIndices = getRandomIndices(test.questions.length, sampleSize);
                
                sampledIndices.forEach(index => {
                    mixedQuestions.push({
                        ...test.questions[index],
                        originalTest: test.id // Keep track of which test it came from
                    });
                });
            });
            
            // If we couldn't collect any questions, show an error
            if (mixedQuestions.length === 0) {
                alert("Could not create mixed quiz. Please try loading the tests again.");
                return;
            }
            
            // Randomize questions order
            const shuffledQuestions = shuffleArray(mixedQuestions);
            
            // Create a special mixed test
            const mixedTest = {
                id: 'mixed',
                name: 'Mixed Questions',
                questions: shuffledQuestions
            };
            
            // Initialize mixed test progress if not exists
            if (!userProgress['mixed']) {
                userProgress['mixed'] = {
                    completed: 0,
                    lastQuestionIndex: 0,
                    answers: Array(shuffledQuestions.length).fill(null)
                };
            } else if (userProgress['mixed'].answers.length !== shuffledQuestions.length) {
                // Reset answers if the number of questions has changed
                userProgress['mixed'].answers = Array(shuffledQuestions.length).fill(null);
                userProgress['mixed'].completed = 0;
                userProgress['mixed'].lastQuestionIndex = 0;
            }
            
            // Start the mixed test
            currentTest = mixedTest;
            userAnswers = [...userProgress['mixed'].answers];
            currentQuestionIndex = userProgress['mixed'].lastQuestionIndex;
            
            // Update test selector
            updateTestSelector();
            
            // Load question
            loadQuestion();
            
            // Show quiz screen
            dashboardScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            
            // Start timer
            startTimer();
        }
        
        // Get random indices from a range
        function getRandomIndices(max, count) {
            const indices = [];
            const available = Array.from({ length: max }, (_, i) => i);
            
            for (let i = 0; i < count && available.length > 0; i++) {
                const randomIndex = Math.floor(Math.random() * available.length);
                indices.push(available[randomIndex]);
                available.splice(randomIndex, 1);
            }
            
            return indices;
        }
        
        // Shuffle array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // Update test selector
        function updateTestSelector() {
            testSelector.innerHTML = '';
            
            quizData.tests.forEach(test => {
                const button = document.createElement('button');
                button.className = 'test-btn' + (test.id === currentTest.id ? ' active' : '');
                button.textContent = test.name;
                button.addEventListener('click', () => {
                    // Save progress
                    saveProgress();
                    // Start new test
                    startTest(test.id);
                });
                
                testSelector.appendChild(button);
            });
            
            // Add mixed questions button
            const mixedButton = document.createElement('button');
            mixedButton.className = 'test-btn' + (currentTest.id === 'mixed' ? ' active' : '');
            mixedButton.textContent = 'Mixed Questions';
            mixedButton.addEventListener('click', () => {
                saveProgress();
                startMixedQuiz();
            });
            
            testSelector.appendChild(mixedButton);
        }
        
        // Load question
        function loadQuestion() {
            const question = currentTest.questions[currentQuestionIndex];
            
            // Update question text
            questionText.textContent = question.question;
            
            // Update image
            if (question.image && question.image !== "null" && question.image !== "") {
                try {
                    // First try to load from the images folder
                    const imagePath = question.image.includes('/') ? question.image : `images/${question.image}`;
                    questionImage.src = imagePath;
                    questionImage.alt = `Image for question ${currentQuestionIndex + 1}`;
                    questionImage.classList.remove('hidden');
                    
                    // Handle image load error
                    questionImage.onerror = function() {
                        // Fall back to placeholder if image doesn't load
                        questionImage.src = `https://via.placeholder.com/400x300?text=${encodeURIComponent(question.image)}`;
                    };
                } catch (error) {
                    // Use placeholder as fallback
                    questionImage.src = `https://via.placeholder.com/400x300?text=${encodeURIComponent(question.image)}`;
                    questionImage.alt = `Image for question ${currentQuestionIndex + 1}`;
                    questionImage.classList.remove('hidden');
                }
            } else {
                questionImage.classList.add('hidden');
            }
            
            // Update options
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = `${String.fromCharCode(65 + index)}. ${option}`;
                
                // Add selected class if previously answered
                if (userAnswers[currentQuestionIndex] === String.fromCharCode(65 + index)) {
                    optionElement.classList.add('selected');
                    
                    // Show explanation
                    showExplanation();
                    
                    // Show correct/incorrect
                    const correctOptionIndex = question.correctAnswer.charCodeAt(0) - 65;
                    
                    if (correctOptionIndex >= 0 && correctOptionIndex < 5) {
                        setTimeout(() => {
                            const options = optionsContainer.querySelectorAll('.option');
                            options[correctOptionIndex].classList.add('correct');
                            if (index !== correctOptionIndex) {
                                optionElement.classList.add('incorrect');
                            }
                        }, 0);
                    }
                }
                
                optionElement.addEventListener('click', () => {
                    selectOption(index);
                });
                
                optionsContainer.appendChild(optionElement);
            });
            
            // Update question counter
            questionCounter.textContent = `Question ${currentQuestionIndex + 1} of ${currentTest.questions.length}`;
            
            // Update progress bar
            const progressPercentage = ((currentQuestionIndex + 1) / currentTest.questions.length) * 100;
            progressBarFill.style.width = `${progressPercentage}%`;
            
            // Update buttons
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.textContent = userAnswers[currentQuestionIndex] 
                ? (currentQuestionIndex === currentTest.questions.length - 1 ? 'Finish' : 'Next') 
                : 'Skip';
            
            // Hide explanation if not answered
            if (!userAnswers[currentQuestionIndex]) {
                explanationContainer.classList.add('hidden');
            }
            
            // Save progress
            saveProgress();
        }
        
        // Select option
        function selectOption(optionIndex) {
            const options = optionsContainer.querySelectorAll('.option');
            const question = currentTest.questions[currentQuestionIndex];
            
            // Clear previous selection
            options.forEach(opt => opt.classList.remove('selected', 'correct', 'incorrect'));
            
            // Select current option
            options[optionIndex].classList.add('selected');
            
            // Save answer
            userAnswers[currentQuestionIndex] = String.fromCharCode(65 + optionIndex);
            
            // Update completed count
            updateCompletedCount();
            
            // Show correct/incorrect
            const correctOptionIndex = question.correctAnswer.charCodeAt(0) - 65;
            if (correctOptionIndex >= 0 && correctOptionIndex < 5) {
                options[correctOptionIndex].classList.add('correct');
                if (optionIndex !== correctOptionIndex) {
                    options[optionIndex].classList.add('incorrect');
                }
            }
            
            // Show explanation
            showExplanation();
            
            // Update next button
            nextBtn.textContent = currentQuestionIndex === currentTest.questions.length - 1 ? 'Finish' : 'Next';
            
            // Save progress
            saveProgress();
        }
        
        // Show explanation
        function showExplanation() {
            const question = currentTest.questions[currentQuestionIndex];
            explanationText.textContent = question.explanation;
            explanationContainer.classList.remove('hidden');
        }
        
        // Go to next question
        function goToNextQuestion() {
            if (currentQuestionIndex < currentTest.questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
                
                // Scroll to top
                window.scrollTo(0, 0);
            } else {
                // End of test
                showResults();
            }
        }
        
        // Go to previous question
        function goToPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
                
                // Scroll to top
                window.scrollTo(0, 0);
            }
        }
        
        // Update completed count
        function updateCompletedCount() {
            const completedCount = userAnswers.filter(answer => answer !== null).length;
            userProgress[currentTest.id].completed = completedCount;
        }
        
        // Save progress (in-memory only)
        function saveProgress() {
            userProgress[currentTest.id].answers = userAnswers;
            userProgress[currentTest.id].lastQuestionIndex = currentQuestionIndex;
        }
        
        // Start timer
        function startTimer() {
            startTime = new Date();
            
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                const currentTime = new Date();
                const elapsedSeconds = Math.floor((currentTime - startTime) / 1000);
                const minutes = Math.floor(elapsedSeconds / 60);
                const seconds = elapsedSeconds % 60;
                
                timeSpent.textContent = `Time: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }
        
        // Stop timer
        function stopTimer() {
            clearInterval(timerInterval);
        }
        
        // Show results
        function showResults() {
            stopTimer();
            
            // Calculate results
            const totalQuestions = currentTest.questions.length;
            const attemptedQuestions = userAnswers.filter(answer => answer !== null).length;
            const correctAnswers = userAnswers.reduce((count, answer, index) => {
                if (answer === currentTest.questions[index].correctAnswer) {
                    return count + 1;
                }
                return count;
            }, 0);
            
            const incorrectAnswers = attemptedQuestions - correctAnswers;
            const accuracy = attemptedQuestions > 0 ? Math.round((correctAnswers / attemptedQuestions) * 100) : 0;
            
            // Update UI
            document.getElementById('completedQuestions').textContent = attemptedQuestions;
            document.getElementById('totalQuestions').textContent = totalQuestions;
            document.getElementById('resultProgressFill').style.width = `${(attemptedQuestions / totalQuestions) * 100}%`;
            document.getElementById('correctAnswers').textContent = correctAnswers;
            document.getElementById('incorrectAnswers').textContent = incorrectAnswers;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
            
            // Calculate time
            const elapsedSeconds = Math.floor((new Date() - startTime) / 1000);
            const minutes = Math.floor(elapsedSeconds / 60);
            const seconds = elapsedSeconds % 60;
            document.getElementById('totalTime').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Show results screen
            quizScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
        }
        
        // Review answers
        function reviewAnswers() {
            resultsScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            
            // Start from the beginning
            currentQuestionIndex = 0;
            loadQuestion();
            
            // Restart timer
            startTimer();
        }
        
        // Return to dashboard
        function returnToDashboard() {
            // Save progress
            saveProgress();
            
            // Stop timer
            stopTimer();
            
            // Show dashboard
            resultsScreen.classList.add('hidden');
            quizScreen.classList.add('hidden');
            dashboardScreen.classList.remove('hidden');
            
            // Reload dashboard
            loadDashboard();
        }
    </script>
</body>
</html>
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Loading Quiz Data...</p>
        <p id="loadingStatus">Processing 1,211 questions...</p>
    </div>

    <!-- Main Application -->
    <div class="container" id="appContainer">
        <!-- Header -->
        <div class="header">
            <h1>Medical Quiz Application</h1>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">M</div>
                <span id="userDisplay">Medical Student</span>
            </div>
        </div>

        <!-- Dashboard / Progress Screen -->
        <div id="dashboardScreen">
            <h2>Quiz Tests</h2>
            <p>Select a test to start practicing</p>
            
            <!-- Overall Progress Summary -->
            <div class="overall-progress">
                <div class="result-container">
                    <h3>Overall Progress</h3>
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-value" id="totalAttempted">0</div>
                            <div class="stat-label">Questions Attempted</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalCorrect">0</div>
                            <div class="stat-label">Correct Answers</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalWrong">0</div>
                            <div class="stat-label">Incorrect Answers</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="overallAccuracy">0%</div>
                            <div class="stat-label">Accuracy</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="button" id="mixedQuizBtn">Start Mixed Questions Quiz</button>
                    </div>
                </div>
            </div>
            
            <h3 style="margin-top: 30px;">Individual Tests</h3>
            <div class="progress-container" id="progressContainer">
                <!-- Test cards will be dynamically generated here -->
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quizScreen" class="hidden">
            <div class="test-selector" id="testSelector">
                <!-- Test buttons will be dynamically generated here -->
            </div>
            
            <div class="quiz-container">
                <div class="progress-detail">
                    <span id="questionCounter">Question 1 of 100</span>
                    <span id="timeSpent">Time: 00:00</span>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="progressBarFill" style="width: 1%;"></div>
                </div>
                
                <div class="question-container" id="questionContainer">
                    <p class="question-text" id="questionText"></p>
                    <img id="questionImage" class="question-image hidden" src="" alt="Question Image">
                    <div class="options-container" id="optionsContainer">
                        <!-- Options will be dynamically generated here -->
                    </div>
                </div>
                
                <div class="navigation">
                    <button class="button" id="prevBtn">Previous</button>
                    <button class="button" id="nextBtn">Next</button>
                </div>
            </div>
            
            <div class="explanation-container hidden" id="explanationContainer">
                <h3>Explanation</h3>
                <p id="explanationText"></p>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="hidden">
            <div class="result-container">
                <h2>Quiz Results</h2>
                <div id="resultsOverview">
                    <p>You've completed <span id="completedQuestions">0</span> out of <span id="totalQuestions">100</span> questions.</p>
                    <div class="progress-bar">
                        <div class="progress-bar-fill" id="resultProgressFill" style="width: 0%;"></div>
                    </div>
                </div>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="correctAnswers">0</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="incorrectAnswers">0</div>
                        <div class="stat-label">Incorrect</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="accuracy">0%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalTime">00:00</div>
                        <div class="stat-label">Total Time</div>
                    </div>
                </div>
                
                <div class="navigation">
                    <button class="button" id="reviewBtn">Review Answers</button>
                    <button class="button" id="returnToDashboardBtn">Return to Dashboard</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Instructions Section -->
    <div class="container" style="margin-top: 50px; padding-top: 30px; border-top: 1px solid #ddd;">
        <h2>Medical Quiz Application - 1,211 Questions</h2>
        
        <div style="background-color: white; padding: 20px; border-radius: 8px; margin-top: 20px;">
            <h3>About This Application</h3>
            <p>This medical quiz application loads your questions from the "Questions.csv" file. The questions are divided into 12 tests of approximately 101 questions each.</p>
            
            <h3>Setup Instructions</h3>
            <ol>
                <li><strong>Save the HTML file</strong> to your computer</li>
                <li><strong>Place "Questions.csv"</strong> in the same folder as the HTML file</li>
                <li><strong>Create an 'images' folder</strong> in the same directory</li>
                <li><strong>Add image files</strong> to the images folder (they should be named according to the references in the CSV)</li>
                <li><strong>Use a local web server</strong> to run the application (required for loading local files)</li>
            </ol>
            
            <h3>Important Note About Local Files</h3>
            <p>Due to browser security restrictions, you <strong>cannot</strong> simply open the HTML file directly in your browser when loading local CSV files. You have two options:</p>
            <ol>
                <li><strong>Use a local web server:</strong> Install a simple web server like <a href="https://www.npmjs.com/package/http-server" target="_blank">http-server</a> (via npm) and run it in the folder with your files.</li>
                <li><strong>Use VS Code with Live Server:</strong> If you have Visual Studio Code, install the "Live Server" extension, right-click the HTML file, and select "Open with Live Server".</li>
            </ol>
            
            <h3>Features</h3>
            <ul>
                <li><strong>External Data Loading:</strong> All questions are loaded from your CSV file.</li>
                <li><strong>Progress Tracking:</strong> Your progress is tracked for each test and overall.</li>
                <li><strong>Mixed Quiz Mode:</strong> Test yourself with questions randomly selected from all tests.</li>
                <li><strong>Image Support:</strong> The application shows images for questions that have them.</li>
            </ul>
            
            <h3>Using the Application</h3>
            <ol>
                <li><strong>Select a Test:</strong> Choose from one of the 12 tests or try the Mixed Questions mode.</li>
                <li><strong>Answer Questions:</strong> Select your answer for each question.</li>
                <li><strong>Review Explanations:</strong> After answering, you'll see the correct answer and explanation.</li>
                <li><strong>Track Progress:</strong> Your overall progress is shown on the dashboard.</li>
            </ol>
        </div>
    </div>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Quiz Application</title>
    <style>
        :root {
            --primary-color: #4a89dc;
            --secondary-color: #5d9cec;
            --dark-color: #2c3e50;
            --light-color: #f5f7fa;
            --success-color: #8cc152;
            --error-color: #da4453;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1, h2, h3 {
            margin-bottom: 0.5rem;
        }
        
        .quiz-container, .progress-container, .result-container, .explanation-container {
            background-color: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .progress-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .overall-progress {
            margin-bottom: 30px;
        }
        
        .test-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            width: calc(25% - 10px);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .test-card h3 {
            color: var(--primary-color);
        }
        
        .progress-bar {
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            background-color: var(--success-color);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .question-container {
            margin-bottom: 2rem;
        }
        
        .question-text {
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }
        
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option {
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .option:hover {
            background-color: #f5f5f5;
        }
        
        .option.selected {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .option.correct {
            background-color: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }
        
        .option.incorrect {
            background-color: var(--error-color);
            color: white;
            border-color: var(--error-color);
        }
        
        .button {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            background-color: var(--secondary-color);
        }
        
        .button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .hidden {
            display: none;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }
        
        .question-image {
            max-width: 100%;
            max-height: 300px;
            margin: 1rem 0;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .explanation-container {
            margin-top: 2rem;
            border-left: 4px solid var(--primary-color);
        }
        
        .test-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 0.5rem 1rem;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .test-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .progress-detail {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 1rem;
        }
        
        .stat-item {
            text-align: center;
            padding: 1rem;
            background-color: #f5f7fa;
            border-radius: 8px;
            flex: 1;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            color: white;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .test-card {
                width: calc(50% - 10px);
            }
            
            .stats {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .test-card {
                width: 100%;
            }
        }
